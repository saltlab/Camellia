StackExchange.postValidation=function(){function e(e,t,n){var l=e.find('input[type="submit"]:visible'),d=l.length&&l.is(":enabled");d&&l.attr("disabled",!0),i(e),a(e,t,n),s(e),r(e),c(e);var u=function(){1!=t||e.find(v).length?(o(e),d&&l.attr("disabled",!1)):setTimeout(u,250)};u()}function t(t,i,a,o,s){e(t,i,o);var r,c=function(e){if(e.success)if(s)s(e);else{var n=window.location.href.split("#")[0],o=e.redirectTo.split("#")[0];0==o.indexOf("/")&&(o=window.location.protocol+"//"+window.location.hostname+o),r=!0,window.location=e.redirectTo,n.toLowerCase()==o.toLowerCase()&&window.location.reload(!0)}else e.captchaHtml?StackExchange.captcha.init(e.captchaHtml,c):e.errors?u(e.errors,t,i,a):t.find('input[type="submit"]:visible').parent().showErrorMessage(e.message)};t.submit(function(){if(t.find("#answer-from-ask").is(":checked"))return!0;var e=t.find(b);return"[Edit removed during grace period]"==$.trim(e.val())?(p(e,["Comment reserved for system use. Please use an appropriate comment."],l()),!1):(n(),StackExchange.navPrevention&&StackExchange.navPrevention.stop(),t.find('input[type="submit"]:visible').parent().addSpinner(),StackExchange.helpers.disableSubmitButton(t),setTimeout(function(){$.ajax({"type":"POST","dataType":"json","data":t.serialize(),"url":t.attr("action"),"success":c,"error":function(){var e;switch(a){case"question":e="An error occurred submitting the question.";break;case"answer":e="An error occurred submitting the answer.";break;case"edit":e="An error occurred submitting the edit.";break;case"tags":e="An error occurred submitting the tags.";break;case"post":default:e="An error occurred submitting the post."}t.find('input[type="submit"]:visible').parent().showErrorMessage(e)},"complete":function(){StackExchange.helpers.removeSpinner(),r||StackExchange.helpers.enableSubmitButton(t)}})},0),!1)})}function n(){for(var e=0;e<x.length;e++)clearTimeout(x[e]);x=[]}function i(e){var t=e.find(g);t.length&&t.blur(function(){x.push(setTimeout(function(){var n=t.val(),i=$.trim(n);if(0==i.length)return h(e,t),void 0;var a=t.data("min-length");if(a&&i.length<a)return p(t,[function(e){return 1==e.minLength?"Title must be at least "+e.minLength+" character.":"Title must be at least "+e.minLength+" characters."}({"minLength":a})],l()),void 0;var o=t.data("max-length");return o&&i.length>o?(p(t,[function(e){return 1==e.maxLength?"Title cannot be longer than "+e.maxLength+" character.":"Title cannot be longer than "+e.maxLength+" characters."}({"maxLength":o})],l()),void 0):($.ajax({"type":"POST","url":"/posts/validate-title","data":{"title":n},"success":function(n){n.success?h(e,t):p(t,n.errors.Title,l())},"error":function(){h(e,t)}}),void 0)},y))})}function a(e,t,n){var i=e.find(m);i.length&&i.blur(function(){x.push(setTimeout(function(){var a=i.val(),o=$.trim(a);if(0==o.length)return h(e,i),void 0;if(5==t){var s=i.data("min-length");return s&&o.length<s?p(i,[function(e){return"Wiki Body must be at least "+e.minLength+" characters. You entered "+e.actual+"."}({"minLength":s,"actual":o.length})],l()):h(e,i),void 0}(1==t||2==t)&&$.ajax({"type":"POST","url":"/posts/validate-body","data":{"body":a,"oldBody":i.prop("defaultValue"),"isQuestion":1==t,"isSuggestedEdit":n},"success":function(t){t.success?h(e,i):p(i,t.errors.Body,l())},"error":function(){h(e,i)}})},y))})}function o(e){var t=e.find(v);if(t.length){var n=t.parent().find("input#tagnames");n.blur(function(){x.push(setTimeout(function(){var i=n.val(),a=$.trim(i);return 0==a.length?(h(e,t),void 0):($.ajax({"type":"POST","url":"/posts/validate-tags","data":{"tags":i,"oldTags":n.prop("defaultValue")},"success":function(n){n.success?h(e,t):p(t,n.errors.Tags,l())},"error":function(){h(e,t)}}),void 0)},y))})}}function s(e){var t=e.find(b);t.length&&t.blur(function(){x.push(setTimeout(function(){var n=t.val(),i=$.trim(n);if(0==i.length)return h(e,t),void 0;var a=t.data("min-length");if(a&&i.length<a)return p(t,[function(e){return 1==e.minLength?"Your edit summary must be at least "+e.minLength+" character.":"Your edit summary must be at least "+e.minLength+" characters."}({"minLength":a})],l()),void 0;var o=t.data("max-length");return o&&i.length>o?(p(t,[function(e){return 1==e.maxLength?"Your edit summary cannot be longer than "+e.maxLength+" character.":"Your edit summary cannot be longer than "+e.maxLength+" characters."}({"maxLength":o})],l()),void 0):(h(e,t),void 0)},y))})}function r(e){var t=e.find(w);t.length&&t.blur(function(){x.push(setTimeout(function(){var n=t.val(),i=$.trim(n);if(0==i.length)return h(e,t),void 0;var a=t.data("min-length");if(a&&i.length<a)return p(t,[function(e){return"Wiki Excerpt must be at least "+e.minLength+" characters; you entered "+e.actual+"."}({"minLength":a,"actual":i.length})],l()),void 0;var o=t.data("max-length");return o&&i.length>o?(p(t,[function(e){return"Wiki Excerpt cannot be longer than "+e.maxLength+" characters; you entered "+e.actual+"."}({"maxLength":o,"actual":i.length})],l()),void 0):(h(e,t),void 0)},y))})}function c(e){var t=e.find(k);t.length&&t.blur(function(){x.push(setTimeout(function(){var n=t.val(),i=$.trim(n);return 0==i.length?(h(e,t),void 0):/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,20}$/i.test(n)?(h(e,t),void 0):(p(t,["This email does not appear to be valid."],d()),void 0)},y))})}function l(){var e=$("#sidebar, .sidebar").first().width()||270;return{"position":{"my":"left top","at":"right center"},"css":{"max-width":e,"min-width":e},"closeOthers":!1}}function d(){var e=$("#sidebar, .sidebar").first().width()||270;return{"position":{"my":"left top","at":"right center"},"css":{"min-width":e},"closeOthers":!1}}function u(e,t,n,i){if(e){var a=function(){var n=0;p(t.find(g),e.Title,l())?n++:h(t,t.find(g)),p(t.find(m),e.Body,l())?n++:h(t,t.find(m)),p(t.find(v),e.Tags,l())?n++:h(t,t.find(v)),p(t.find(b),e.EditComment,l())?n++:h(t,t.find(b)),p(t.find(w),e.Excerpt,l())?n++:h(t,t.find(w)),p(t.find(k),e.Email,d())?n++:h(t,t.find(k));var a=t.find(".general-error"),o=e.General&&e.General.length>0;if(o||n>0){if(!a.length){var s=t.find('input[type="submit"]:visible');s.before('<div class="general-error-container"><div class="general-error"></div><br class="cbt" /></div>'),a=t.find(".general-error")}if(o)p(a,e.General,{"position":"inline","css":{"float":"left","margin-bottom":"10px"},"closeOthers":!1,"dismissable":!1});else{h(t,a);var r;switch(i){case"question":r=function(e){return 1==e.specificErrorCount?"Your question couldn't be submitted. Please see the error above.":"Your question couldn't be submitted. Please see the errors above."}({"specificErrorCount":n});break;case"answer":r=function(e){return 1==e.specificErrorCount?"Your answer couldn't be submitted. Please see the error above.":"Your answer couldn't be submitted. Please see the errors above."}({"specificErrorCount":n});break;case"edit":r=function(e){return 1==e.specificErrorCount?"Your edit couldn't be submitted. Please see the error above.":"Your edit couldn't be submitted. Please see the errors above."}({"specificErrorCount":n});break;case"tags":r=function(e){return 1==e.specificErrorCount?"Your tags couldn't be submitted. Please see the error above.":"Your tags couldn't be submitted. Please see the errors above."}({"specificErrorCount":n});break;case"post":default:r=function(e){return 1==e.specificErrorCount?"Your post couldn't be submitted. Please see the error above.":"Your post couldn't be submitted. Please see the errors above."}({"specificErrorCount":n})}a.text(r)}}else t.find(".general-error-container").remove();var c;f()&&($("#sidebar").animate({"opacity":.4},500),c=setInterval(function(){f()||($("#sidebar").animate({"opacity":1},500),clearInterval(c))},500));var u;t.find(".validation-error").each(function(){var e=$(this).offset().top;(!u||u>e)&&(u=e)});var x=function(){for(var e=0;3>e;e++)t.find(".message").animate({"left":"+=5px"},100).animate({"left":"-=5px"},100)};if(u){var y=$(".review-bar").length;u=Math.max(0,u-(y?125:30)),$("html, body").animate({"scrollTop":u},x)}else x()},o=function(){1!=n||t.find(v).length?a():setTimeout(o,250)};o()}}function p(e,t,i){var a;if(!(t&&0!=t.length&&e.length&&$("html").has(e).length))return!1;if(a=1==t.length?t[0]:"<ul><li>"+t.join("</li><li>")+"</li></ul>",a&&a.length>0){var o=e.data("error-popup");if(o&&o.is(":visible")){var s=e.data("error-message");if(s==a)return!0;o.fadeOutAndRemove()}var r=StackExchange.helpers.showMessage(e,a,i);return r.find("a").attr("target","_blank"),e.addClass("validation-error"),e.data("error-popup",r),e.data("error-message",a),r.click(n),!0}return!1}function h(e,t){if(!t||0==t.length)return!1;var n=t.data("error-popup");return n&&n.is(":visible")&&n.fadeOutAndRemove(),t.removeClass("validation-error"),t.removeData("error-popup"),t.removeData("error-message"),e.find(".validation-error").length||e.find(".general-error-container").remove(),!0}function f(){var e=!1,t=$("#sidebar, .sidebar").first();if(!t.length)return!1;var n=t.offset().left;return $(".message").each(function(){var t=$(this);return t.offset().left+t.outerWidth()>n?(e=!0,!1):void 0}),e}var g="input#title",m="textarea.wmd-input:first",v=".tag-editor",b="input[id^=edit-comment]",w="textarea#excerpt",k="input#m-address",x=[],y=250;return{"initOnBlur":e,"initOnBlurAndSubmit":t,"showErrorsAfterSubmission":u,"getSidebarPopupOptions":l}}();
